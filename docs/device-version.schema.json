{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Device Version Protocol (DVP) v1",
  "type": "object",
  "required": ["protocol", "protocol_version", "device", "versions"],
  "properties": {
    "protocol": { "type": "string", "const": "dvp" },
    "protocol_version": { "type": "integer", "const": 1 },
    "timestamp": { "type": "string" },
    "device": {
      "type": "object",
      "required": ["id", "supplier", "device_type"],
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "supplier": { "type": "string", "minLength": 1 },
        "device_type": { "type": "string", "minLength": 1 },
        "serial": { "type": "string" }
      },
      "additionalProperties": true
    },
    "versions": {
      "type": "object",
      "required": ["main"],
      "properties": {
        "main": { "type": "string", "minLength": 1 },
        "firmware": { "type": "string" },
        "bootloader": { "type": "string" }
      },
      "additionalProperties": true
    },
    "components": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "version"],
        "properties": {
          "name": { "type": "string", "minLength": 1 },
          "version": { "type": "string", "minLength": 1 },
          "checksum": { "type": "string" },
          "build": { "type": "string" }
        },
        "additionalProperties": true
      }
    },
    "files": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["path"],
        "properties": {
          "path": { "type": "string", "minLength": 1 },
          "checksum": { "type": "string" },
          "size": { "type": "integer" },
          "mtime": {},
          "encoding": { "type": "string" },
          "content_type": { "type": "string" },
          "content_b64": { "type": "string" },
          "truncated": { "type": "boolean" }
        },
        "additionalProperties": true
      }
    },
    "build": {
      "type": "object",
      "properties": {
        "git": { "type": "string" },
        "time": { "type": "string" },
        "image": { "type": "string" }
      },
      "additionalProperties": true
    },
    "main_version_info": {
      "type": "object",
      "description": "Optional metadata for versions.main, reported by device (DVP v1 extension).",
      "properties": {
        "changelog_md": { "type": "string" },
        "released_at": { "type": "string" },
        "checksum": { "type": "string" }
      },
      "additionalProperties": true
    },
    "docs": {
      "type": "array",
      "description": "Optional inline documentation blobs (typically Markdown) for future analysis (DVP v1 extension).",
      "items": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": { "type": "string", "minLength": 1 },
          "checksum": { "type": "string" },
          "encoding": { "type": "string" },
          "content_type": { "type": "string" },
          "content_b64": { "type": "string" },
          "truncated": { "type": "boolean" }
        },
        "additionalProperties": true
      }
    }
  },
  "additionalProperties": true
}
